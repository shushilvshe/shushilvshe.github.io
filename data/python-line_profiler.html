
<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://www.shushilvshe.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://www.shushilvshe.com/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="http://www.shushilvshe.com/theme/font-awesome/css/font-awesome.min.css">




    <link rel="shortcut icon" href="http://www.shushilvshe.com/images/lvcheng.jpg" type="image/x-icon">
    <link rel="icon" href="http://www.shushilvshe.com/images/lvcheng.jpg" type="image/x-icon">



<meta name="author" content="ssls" />
<meta name="description" content="python性能调试过程中最突出的问题就是耗时，性能测试工具有很多，像profiler，cprofiler等等，都是只能返回函数整体的耗时，而line_profiler就能够很好解决这个问题。" />
<meta name="keywords" content="python, line_profiler">

<meta property="og:site_name" content="shushilvshe's Blog"/>
<meta property="og:title" content="python性能调试工具line_profiler"/>
<meta property="og:description" content="python性能调试过程中最突出的问题就是耗时，性能测试工具有很多，像profiler，cprofiler等等，都是只能返回函数整体的耗时，而line_profiler就能够很好解决这个问题。"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://www.shushilvshe.com/data/python-line_profiler.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-08-09 14:46:24+08:00"/>
<meta property="article:modified_time" content="2018-08-09 14:46:29+08:00"/>
<meta property="article:author" content="http://www.shushilvshe.com/author/ssls.html">
<meta property="article:section" content="Data"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="line_profiler"/>
<meta property="og:image" content="http://www.shushilvshe.com/images/self.jpg">

  <title>shushilvshe's Blog &ndash; python性能调试工具line_profiler</title>

</head>
<body>

  <aside>
    <div>
      <a href="http://www.shushilvshe.com">
        <img src="http://www.shushilvshe.com/images/self.jpg" alt="数食旅摄" title="数食旅摄">
      </a>
      <h1><a href="http://www.shushilvshe.com">数食旅摄</a></h1>

<p>Data Developer</p>
      <nav>
        <ul class="list">
          <li><a href="http://www.shushilvshe.com/pages/about.html#about">About ME</a></li>

          <li><a href="/categories.html" target="_blank">Category</a></li>
          <li><a href="/tags.html" target="_blank">Tags</a></li>
          <li><a href="/archives.html" target="_blank">Archives</a></li>
        </ul>
      </nav>

      <ul class="social">
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="http://www.shushilvshe.com">    Home
</a>

      <a href="/category/data.html">Data</a>
      <a href="/category/food.html">Food</a>
      <a href="/category/travel.html">Travel</a>
      <a href="/category/photo.html">Photo</a>
      <a href="/category/bytalk.html">ByTalk</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="data/python-line_profiler">python性能调试工具line_profiler</h1>
    <p>
          Posted on 2018-08-09(星期四) 14:46 in <a href="http://www.shushilvshe.com/category/data.html">Data</a>


    </p>
  </header>


  <div>
    <p>python性能调试过程中最突出的问题就是耗时，性能测试工具有很多，像profiler，cprofiler等等，都是只能返回函数整体的耗时，而line_profiler就能够很好解决这个问题。</p>
<p>怎么使用这个工具呢？网上大部分都是说在所需要测的函数前面加一个@profile，如文档所说。但是加了@profile后函数无法直接运行，只能优化的时候加上，调试的时候又得去掉。文章中提到了这个问题的解决办法，个人觉得还是有点麻烦，不太能理解这是为什么。我在stackoverflow上看到了另一种关于line_profile的使用方法，简单而且实用。</p>
<p>安装：</p>
<div class="highlight"><pre><span></span>pip install line_profiler
</pre></div>


<p>这是使用案例：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">line_profiler</span> <span class="kn">import</span> <span class="n">LineProfiler</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">43</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">))]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">))]</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
<span class="n">lp</span> <span class="o">=</span> <span class="n">LineProfiler</span><span class="p">()</span>
<span class="n">lp_wrapper</span> <span class="o">=</span> <span class="n">lp</span><span class="p">(</span><span class="n">do_stuff</span><span class="p">)</span>
<span class="n">lp_wrapper</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="n">lp</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>


<p>输出结果：</p>
<div class="highlight"><pre><span></span>Timer unit: 1e-06 s

Total time: 0.000649 s
File: &lt;ipython-input-2-2e060b054fea&gt;
Function: do_stuff at line 4

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
     4                                           def do_stuff(numbers):
     5         1           10     10.0      1.5      s = sum(numbers)
     6         1          186    186.0     28.7      l = [numbers[i]/43 for i in range(len(numbers))]
     7         1          453    453.0     69.8      m = [&#39;hello&#39;+str(numbers[i]) for i in range(len(numbers))]
</pre></div>


<p>这种方法就比较好用了，如果你想在其他文件中调用这个包含line_profiler函数测试的文件，又不想把这个信息显示出来，使用</p>
<div class="highlight"><pre><span></span>if __name__ == &#39;__main__&#39;:
</pre></div>


<p>对于函数内部调用函数的情况：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">line_profiler</span> <span class="kn">import</span> <span class="n">LineProfiler</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">do_other_stuff</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="n">do_other_stuff</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">43</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">))]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">))]</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
<span class="n">lp</span> <span class="o">=</span> <span class="n">LineProfiler</span><span class="p">()</span>
<span class="n">lp_wrapper</span> <span class="o">=</span> <span class="n">lp</span><span class="p">(</span><span class="n">do_stuff</span><span class="p">)</span>
<span class="n">lp_wrapper</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="n">lp</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>


<p>这样做的话，只能显示子函数的总时间。输出如下：</p>
<div class="highlight"><pre><span></span>Timer unit: 1e-06 s

Total time: 0.000773 s
File: &lt;ipython-input-3-ec0394d0a501&gt;
Function: do_stuff at line 7

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
     7                                           def do_stuff(numbers):
     8         1           11     11.0      1.4      do_other_stuff(numbers)
     9         1          236    236.0     30.5      l = [numbers[i]/43 for i in range(len(numbers))]
    10         1          526    526.0     68.0      m = [&#39;hello&#39;+str(numbers[i]) for i in range(len(numbers))]
</pre></div>


<p>为了能够同时显示函数每行所用时间和调用函数每行所用时间，加入add_function就能够解决。</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">line_profiler</span> <span class="kn">import</span> <span class="n">LineProfiler</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">do_other_stuff</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="n">do_other_stuff</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">43</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">))]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">))]</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
<span class="n">lp</span> <span class="o">=</span> <span class="n">LineProfiler</span><span class="p">()</span>
<span class="n">lp</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">do_other_stuff</span><span class="p">)</span>   <span class="c1"># add additional function to profile</span>
<span class="n">lp_wrapper</span> <span class="o">=</span> <span class="n">lp</span><span class="p">(</span><span class="n">do_stuff</span><span class="p">)</span>
<span class="n">lp_wrapper</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="n">lp</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>


<p>输出：</p>
<div class="highlight"><pre><span></span>Timer unit: 1e-06 s

Total time: 9e-06 s
File: &lt;ipython-input-4-dae73707787c&gt;
Function: do_other_stuff at line 4

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
     4                                           def do_other_stuff(numbers):
     5         1            9      9.0    100.0      s = sum(numbers)

Total time: 0.000694 s
File: &lt;ipython-input-4-dae73707787c&gt;
Function: do_stuff at line 7

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
     7                                           def do_stuff(numbers):
     8         1           12     12.0      1.7      do_other_stuff(numbers)
     9         1          208    208.0     30.0      l = [numbers[i]/43 for i in range(len(numbers))]
    10         1          474    474.0     68.3      m = [&#39;hello&#39;+str(numbers[i]) for i in range(len(numbers))]
</pre></div>


<p>另一篇可参考：</p>
<p><code>https://blog.csdn.net/Meow323/article/details/52614504</code></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="http://www.shushilvshe.com/tag/python.html">python</a>
      <a href="http://www.shushilvshe.com/tag/line_profiler.html">line_profiler</a>
    </p>
  </div>



    <div class="addthis_relatedposts_inline">


</article>

    <footer>
<p>&copy;  </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " shushilvshe's Blog ",
  "url" : "http://www.shushilvshe.com",
  "image": "http://www.shushilvshe.com/images/self.jpg",
  "description": "shushilvshe's Thoughts and Writings"
}
</script>

</body>
</html>