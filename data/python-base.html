
<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://www.shushilvshe.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://www.shushilvshe.com/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="http://www.shushilvshe.com/theme/font-awesome/css/font-awesome.min.css">




    <link rel="shortcut icon" href="http://www.shushilvshe.com/images/lvcheng.jpg" type="image/x-icon">
    <link rel="icon" href="http://www.shushilvshe.com/images/lvcheng.jpg" type="image/x-icon">



<meta name="author" content="ssls" />
<meta name="description" content="python常用功能总结" />
<meta name="keywords" content="大数据, python">

<meta property="og:site_name" content="shushilvshe's Blog"/>
<meta property="og:title" content="python常用功能总结"/>
<meta property="og:description" content="python常用功能总结"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://www.shushilvshe.com/data/python-base.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-09-06 10:09:29+08:00"/>
<meta property="article:modified_time" content="2017-09-06 10:09:31+08:00"/>
<meta property="article:author" content="http://www.shushilvshe.com/author/ssls.html">
<meta property="article:section" content="Data"/>
<meta property="article:tag" content="大数据"/>
<meta property="article:tag" content="python"/>
<meta property="og:image" content="http://www.shushilvshe.com/images/baya.jpg">

  <title>shushilvshe's Blog &ndash; python常用功能总结</title>

</head>
<body>

  <aside>
    <div>
      <a href="http://www.shushilvshe.com">
        <img src="http://www.shushilvshe.com/images/baya.jpg" alt="数食旅摄" title="数食旅摄">
      </a>
      <h1><a href="http://www.shushilvshe.com">数食旅摄</a></h1>

<p>Data Developer</p>
      <nav>
        <ul class="list">
          <li><a href="http://www.shushilvshe.com/pages/about.html#about">About ME</a></li>

          <li><a href="/categories.html" target="_blank">Category</a></li>
          <li><a href="/tags.html" target="_blank">Tags</a></li>
          <li><a href="/archives.html" target="_blank">Archives</a></li>
        </ul>
      </nav>

      <ul class="social">
      </ul>
    </div>

  </aside>
  <aside>

    <link rel="stylesheet" href="http://yandex.st/highlightjs/6.2/styles/googlecode.min.css">
 
<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script src="http://yandex.st/highlightjs/6.2/highlight.min.js"></script>
 
<script>hljs.initHighlightingOnLoad();</script> 
<script type="text/javascript">
 $(document).ready(function(){
      $("h2,h3,h4,h5,h6").each(function(i,item){
        var tag = $(item).get(0).localName;
        $(item).attr("id","wow"+i);
        $("#category").append('<a class="new'+tag+'" href="#wow'+i+'">'+$(this).text()+'</a></br>');
        $(".newh2").css("margin-left",0);
        $(".newh3").css("margin-left",30);
        $(".newh4").css("margin-left",60);
        $(".newh5").css("margin-left",90);
        $(".newh6").css("margin-left",120);
      });
 });
</script>
    <div id="category"></div>
  </aside>
  <main>

    <nav>
      <a href="http://www.shushilvshe.com">    Home
</a>

      <a href="/category/data.html">Data</a>
      <a href="/category/food.html">Food</a>
      <a href="/category/travel.html">Travel</a>
      <a href="/">Photo</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="data/python-base">python常用功能总结</h1>
    <p>
          Posted on 2017-09-06(星期三) 10:09 in <a href="http://www.shushilvshe.com/category/data.html">Data</a>


    </p>
  </header>


  <div>
    <p><strong>目录：</strong></p>
<p><link rel="stylesheet" href="http://yandex.st/highlightjs/6.2/styles/googlecode.min.css"></p>
<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>

<script src="http://yandex.st/highlightjs/6.2/highlight.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript">
 $(document).ready(function(){
      $("h2,h3,h4,h5,h6").each(function(i,item){
        var tag = $(item).get(0).localName;
        $(item).attr("id","wow"+i);
        $("#category").append('<a class="new'+tag+'" href="#wow'+i+'">'+$(this).text()+'</a></br>');
        $(".newh2").css("margin-left",0);
        $(".newh3").css("margin-left",20);
        $(".newh4").css("margin-left",40);
        $(".newh5").css("margin-left",60);
        $(".newh6").css("margin-left",80);
      });
 });
</script>

<div id="category"></div>

<h2>一、文件操作</h2>
<hr>
<ul>
<li>
<h3>1.os.path模块</h3>
<ul>
<li><strong>1.os.path.abspath(path)</strong> </li>
</ul>
<p>返回path规范化的绝对路径。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.abspath(&#39;test.csv&#39;) 
&#39;C:\\Python25\\test.csv&#39;     
&gt;&gt;&gt; os.path.abspath(&#39;c:\\test.csv&#39;) 
&#39;c:\\test.csv&#39;   
&gt;&gt;&gt; os.path.abspath(&#39;../csv\\test.csv&#39;) 
&#39;C:\\csv\\test.csv&#39;
</pre></div>


<ul>
<li><strong>2.os.path.split(path)</strong> </li>
</ul>
<p>将path分割成目录和文件名二元组返回。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.split(&#39;c:\\csv\\test.csv&#39;) 
(&#39;c:\\csv&#39;, &#39;test.csv&#39;) 
&gt;&gt;&gt; os.path.split(&#39;c:\\csv\\&#39;) 
(&#39;c:\\csv&#39;, &#39;&#39;)
</pre></div>


<ul>
<li><strong>3.os.path.dirname(path)</strong> </li>
</ul>
<p>返回path的目录。其实就是os.path.split(path)的第一个元素。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.dirname(&#39;c:\\csv\test.csv&#39;) 
&#39;c:\\&#39; 
&gt;&gt;&gt; os.path.dirname(&#39;c:\\csv&#39;) 
&#39;c:\\&#39;
</pre></div>


<ul>
<li><strong>4.os.path.basename(path)</strong> </li>
</ul>
<p>返回path最后的文件名。如何path以／或\结尾，那么就会返回空值。即os.path.split(path)的第二个元素。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.basename(&#39;c:\\test.csv&#39;) 
&#39;test.csv&#39; 
&gt;&gt;&gt; os.path.basename(&#39;c:\\csv&#39;) 
&#39;csv&#39; （这里csv被当作文件名处理了） 
&gt;&gt;&gt; os.path.basename(&#39;c:\\csv\\&#39;) 
&#39;&#39;
</pre></div>


<ul>
<li><strong>5.os.path.commonprefix(list)</strong> </li>
</ul>
<p>返回list中，所有path共有的最长的路径。 </p>
<p>如： 
    &gt;&gt;&gt; os.path.commonprefix(['/home/td','/home/td/ff','/home/td/fff']) 
    '/home/td' </p>
<ul>
<li><strong>6.os.path.exists(path)</strong></li>
</ul>
<p>如果path存在，返回True；如果path不存在，返回False。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.exists(&#39;c:\\&#39;) 
True 
&gt;&gt;&gt; os.path.exists(&#39;c:\\csv\\test.csv&#39;) 
False
</pre></div>


<ul>
<li><strong>7.os.path.isabs(path)</strong> </li>
</ul>
<p>如果path是绝对路径，返回True。 </p>
<ul>
<li><strong>8.os.path.isfile(path)</strong> </li>
</ul>
<p>如果path是一个存在的文件，返回True。否则返回False。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.isfile(&#39;c:\\boot.ini&#39;) 
True 
&gt;&gt;&gt; os.path.isfile(&#39;c:\\csv\\test.csv&#39;) 
False 
&gt;&gt;&gt; os.path.isfile(&#39;c:\\csv\\&#39;) 
False
</pre></div>


<ul>
<li><strong>9.os.path.isdir(path)</strong> </li>
</ul>
<p>如果path是一个存在的目录，则返回True。否则返回False。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.isdir(&#39;c:\\&#39;) 
True 
&gt;&gt;&gt; os.path.isdir(&#39;c:\\csv\\&#39;) 
False 
&gt;&gt;&gt; os.path.isdir(&#39;c:\\windows\\test.csv&#39;) 
False
</pre></div>


<ul>
<li><strong>10.os.path.join(path1[, path2[, ...]])</strong> </li>
</ul>
<p>将多个路径组合后返回，第一个绝对路径之前的参数将被忽略。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.join(&#39;c:\\&#39;, &#39;csv&#39;, &#39;test.csv&#39;) 
&#39;c:\\csv\\test.csv&#39; 
&gt;&gt;&gt; os.path.join(&#39;windows\temp&#39;, &#39;c:\\&#39;, &#39;csv&#39;, &#39;test.csv&#39;) 
&#39;c:\\csv\\test.csv&#39; 
&gt;&gt;&gt; os.path.join(&#39;/home/aa&#39;,&#39;/home/aa/bb&#39;,&#39;/home/aa/bb/c&#39;) 
&#39;/home/aa/bb/c&#39;
</pre></div>


<ul>
<li><strong>11.os.path.normcase(path)</strong> </li>
</ul>
<p>在Linux和Mac平台上，该函数会原样返回path，在windows平台上会将路径中所有字符转换为小写，并将所有斜杠转换为饭斜杠。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.normcase(&#39;c:/windows\\system32\\&#39;) 
&#39;c:\\windows\\system32\\&#39;
</pre></div>


<ul>
<li><strong>12.os.path.normpath(path)</strong> </li>
</ul>
<p>规范化路径。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.normpath(&#39;c://windows\\System32\\../Temp/&#39;) 
&#39;c:\\windows\\Temp&#39;
</pre></div>


<ul>
<li><strong>13.os.path.splitdrive(path)</strong> </li>
</ul>
<p>返回（drivername，fpath）元组 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.splitdrive(&#39;c:\\windows&#39;) 
(&#39;c:&#39;, &#39;\\windows&#39;)
</pre></div>


<ul>
<li><strong>14.os.path.splitext(path)</strong> </li>
</ul>
<p>分离文件名与扩展名；默认返回(fname,fextension)元组，可做分片操作 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.splitext(&#39;c:\\csv\\test.csv&#39;) 
(&#39;c:\\csv\\test&#39;, &#39;.csv&#39;)
</pre></div>


<ul>
<li><strong>15.os.path.getsize(path)</strong> </li>
</ul>
<p>返回path的文件的大小（字节）。 </p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.getsize(&#39;c:\\boot.ini&#39;) 
299L
</pre></div>


<ul>
<li><strong>16.os.path.getatime(path)</strong> </li>
</ul>
<p>返回path所指向的文件或者目录的最后存取时间。 </p>
<ul>
<li><strong>17.os.path.getmtime(path)</strong> </li>
</ul>
<p>返回path所指向的文件或者目录的最后修改时间</p>
</li>
</ul>
<hr>
<ul>
<li>
<h3>2.Python获取指定文件夹下的文件名</h3>
<p>采用os.walk()和os.listdir()两种方法，获取指定文件夹下的文件名。</p>
<ul>
<li><strong>一、os.walk()</strong></li>
</ul>
<p>模块os中的walk()函数可以遍历文件夹下所有的文件。</p>
<div class="highlight"><pre><span></span>os.walk(top, topdown=Ture, onerror=None, followlinks=False)
</pre></div>


<p>该函数可以得到一个三元tupple(dirpath, dirnames, filenames).</p>
<p>参数含义：
- dirpath：string，代表目录的路径；
- dirnames：list，包含了当前dirpath路径下所有的子目录名字（不包含目录路径）；
- filenames：list，包含了当前dirpath路径下所有的非目录子文件的名字（不包含目录路径）。</p>
<p>注意，<strong>dirnames和filenames均不包含路径信息</strong>，如需完整路径，可使用os.path.join(dirpath, dirnames)</p>
<p>下面给出代码;</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">file_name</span><span class="p">(</span><span class="n">file_dir</span><span class="p">):</span> 
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">file_dir</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="c1">#当前目录路径</span>
        <span class="k">print</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span> <span class="c1">#当前路径下所有子目录</span>
        <span class="k">print</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="c1">#当前路径下所有非目录子文件</span>
</pre></div>


<p>当需要特定类型的文件时，代码如下：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">file_name</span><span class="p">(</span><span class="n">file_dir</span><span class="p">):</span> 
    <span class="n">L</span><span class="o">=</span><span class="p">[]</span> 
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">file_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">:</span>
                <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="nb">file</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">L</span>
</pre></div>


<p>其中os.path.splitext()函数将路径拆分为文件名+扩展名，例如os.path.splitext(“E:/lena.jpg”)将得到”E:/lena“+".jpg"。</p>
<ul>
<li><strong>二、os.listdir()</strong></li>
</ul>
<p>os.listdir()函数得到的是仅当前路径下的文件名，不包括子目录中的文件，所有需要使用递归的方法得到全部文件名。</p>
<p>直接给出代码，函数将返回类型为‘.jpeg’个文件名：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">list_name</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">listdir</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">list_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">:</span>
            <span class="n">list_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</pre></div>


</li>
</ul>
<hr>
<h2>二、时间操作</h2>
<ul>
<li>
<h3>python时间戳、时间数组、时间字符串相互转化</h3>
<ul>
<li>
<p>1.将字符串的时间转换为时间戳</p>
<p>方法:将其转换为时间数组，再转换为时间戳。例： a = "2013-10-10 23:40:00"</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">timeArray</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<span class="n">timeStamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timeArray</span><span class="p">))</span>
<span class="n">timeStamp</span> <span class="o">==</span> <span class="mi">1381419600</span>
</pre></div>


</li>
<li>
<p>2.字符串格式更改</p>
<p>方法:先转换为时间数组,然后转换为其他格式。例： a = "2013-10-10 23:40:00", 改为 a = "2013/10/10 23:40:00"</p>
<div class="highlight"><pre><span></span>timeArray = time.strptime(a, &quot;%Y-%m-%d %H:%M:%S&quot;)
otherStyleTime = time.strftime(&quot;%Y/%m/%d %H:%M:%S&quot;, timeArray)
</pre></div>


</li>
<li>
<p>3.时间戳转换为指定格式日期:</p>
<p>方法一: 利用localtime()转换为时间数组,然后格式化为需要的格式,如</p>
<div class="highlight"><pre><span></span>timeStamp = 1381419600
timeArray = time.localtime(timeStamp)
otherStyleTime = time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, timeArray)
otherStyletime == &quot;2013-10-10 23:40:00&quot;
</pre></div>


<p>方法二:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">timeStamp</span> <span class="o">=</span> <span class="mi">1381419600</span>
<span class="n">dateArray</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">timeStamp</span><span class="p">)</span>
<span class="n">otherStyleTime</span> <span class="o">=</span> <span class="n">dateArray</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<span class="n">otherStyletime</span> <span class="o">==</span> <span class="s2">&quot;2013-10-10 23:40:00&quot;</span>
</pre></div>


</li>
<li>
<p>4.获取当前时间并转换为指定日期格式</p>
<p>方法一:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>  <span class="c1">#这是时间戳</span>
<span class="n">timeArray</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">timeStamp</span><span class="p">)</span>
<span class="n">otherStyleTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">timeArray</span><span class="p">)</span>
</pre></div>


<p>方法二:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>  <span class="c1">#这是时间数组格式</span>
<span class="n">otherStyleTime</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
</pre></div>


</li>
<li>
<p>5.获得三天前的时间</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">threeDayAgo</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span> <span class="o">=</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1">#转换为时间戳:</span>
<span class="n">timeStamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">threeDayAgo</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()))</span>
<span class="c1">#转换为其他字符串格式:</span>
<span class="n">otherStyleTime</span> <span class="o">=</span> <span class="n">threeDayAgo</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
</pre></div>


<p>注:timedelta()的参数有:days,hours,seconds,microseconds</p>
</li>
<li>
<p>6.给定时间戳,计算该时间的几天前时间:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">timeStamp</span> <span class="o">=</span> <span class="mi">1381419600</span>
<span class="c1">#先转换为datetime</span>
<span class="n">dateArray</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">timeStamp</span><span class="p">)</span>
<span class="n">threeDayAgo</span> <span class="o">=</span> <span class="n">dateArray</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>


<p>参考5,可以转换为其他的任意格式了</p>
</li>
</ul>
</li>
</ul>
<h2>九、其他</h2>
<ul>
<li>
<h3>1.python执行shell命令</h3>
<ul>
<li>
<p><strong>1 os.system</strong></p>
<p>可以返回运行shell命令状态，同时会在终端输出运行结果</p>
<p>例如 ipython中运行如下命令，返回运行状态status</p>
<div class="highlight"><pre><span></span>os.system(&#39;cat /etc/passwdqc.conf&#39;)
min=disabled,24,11,8,7
max=40
passphrase=3
match=4
similar=deny
random=47
enforce=everyone
retry=3
Out[6]: 0
</pre></div>


</li>
<li>
<p><strong>2 os.popen()</strong></p>
<p>可以返回运行结果</p>
<div class="highlight"><pre><span></span>popen(command [, mode=&#39;r&#39; [, bufsize]]) -&gt; pipe
Open a pipe to/from a command returning a file object.
</pre></div>


<p>运行返回结果</p>
<div class="highlight"><pre><span></span>In [20]: output = os.popen(&#39;cat /proc/cpuinfo&#39;)

In [21]: lineLen = []

In [22]: for line in output.readlines():
    lineLen.append(len(line))
   ....:

In [23]: line
line     lineLen

In [23]: lineLen
Out[23]: 
[14,
 25,
...
</pre></div>


</li>
<li>
<p><strong>3 如何同时返回结果和运行状态，commands模块:</strong></p>
<p>#String form: <module 'commands' from '/usr/lib64/python2.7/commands.pyc'>
File: /usr/lib64/python2.7/commands.py
Docstring:
Execute shell commands via os.popen() and return status, output.</p>
<p>Interface summary:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">commands</span>

<span class="n">outtext</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="p">(</span><span class="n">exitstatus</span><span class="p">,</span> <span class="n">outtext</span><span class="p">)</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getstatusoutput</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="n">outtext</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getstatus</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="c1"># returns output of &quot;ls -ld file&quot;</span>

<span class="n">A</span> <span class="n">trailing</span> <span class="n">newline</span> <span class="ow">is</span> <span class="n">removed</span> <span class="kn">from</span> <span class="nn">the</span> <span class="nn">output</span> <span class="nn">string.</span>

<span class="n">Encapsulates</span> <span class="n">the</span> <span class="n">basic</span> <span class="n">operation</span><span class="p">:</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;{ &#39;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s1">&#39;; } 2&gt;&amp;1&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">sts</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<p>commands示例如下:</p>
<div class="highlight"><pre><span></span>In [24]: (status, output) = commands.getstatusoutput(&#39;cat /proc/cpuinfo&#39;)

In [25]: status
Out[25]: 0

In [26]: len(output)
Out[26]: 3859
</pre></div>


</li>
<li>
<p><strong>4 使用模块subprocess</strong></p>
<p>通常项目中经常使用方法为subporcess.Popen, 我们可以在Popen()建立子进程的时候改变标准输入、标准输出和标准错误，并可以利用subprocess.PIPE将多个子进程的输入和输出连接在一起，构成管道(pipe):</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">child1</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span><span class="s2">&quot;-l&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">child2</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;wc&quot;</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">child1</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">child2</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>


<p>在例如使用lsblk查看swap分区的uuid：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">child</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;lsblk&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

<span class="n">swap_uuid</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;swap&#39;</span><span class="p">):</span>
            <span class="n">swap_uuid</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">swap_uuid</span><span class="p">)</span>
</pre></div>


<p>ipython 中运行"?subprocess"可以发现subprocess是python用来替换os.popen()等管道操作命令的新模块。</p>
<p>A more real-world example would look like this:</p>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="o">:</span>
    <span class="n">retcode</span> <span class="o">=</span> <span class="n">call</span><span class="o">(</span><span class="s2">&quot;mycmd&quot;</span> <span class="o">+</span> <span class="s2">&quot; myarg&quot;</span><span class="o">,</span> <span class="n">shell</span><span class="o">=</span><span class="n">True</span><span class="o">)</span>
    <span class="k">if</span> <span class="n">retcode</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">:</span>
        <span class="n">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="na">stderr</span><span class="o">,</span> <span class="s2">&quot;Child was terminated by signal&quot;</span><span class="o">,</span> <span class="o">-</span><span class="n">retcode</span>
    <span class="k">else</span><span class="o">:</span>
        <span class="n">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="na">stderr</span><span class="o">,</span> <span class="s2">&quot;Child returned&quot;</span><span class="o">,</span> <span class="n">retcode</span>
<span class="n">except</span> <span class="n">OSError</span><span class="o">,</span> <span class="n">e</span><span class="o">:</span>
    <span class="n">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="na">stderr</span><span class="o">,</span> <span class="s2">&quot;Execution failed:&quot;</span><span class="o">,</span> <span class="n">e</span>
</pre></div>


<p>相对于上面几种方式，subprocess便于控制和监控进程运行结果,subprocess提供多种函数便于应对父进程对子进程不同要求:</p>
<ul>
<li>4.1.1 subprocess.call()</li>
</ul>
<p>父进程父进程等待子进程完成，返回exit code</p>
<ul>
<li>
<p>4.1.2 subprocess.check_call()</p>
<p>父进程等待子进程完成,返回0，如果returncode不为0，则举出错误subprocess.CalledProcessError，该对象包含有returncode属性，可用try...except...来检查</p>
</li>
<li>
<p>4.1.3 subprocess.check_output()</p>
</li>
</ul>
<p>父进程等待子进程完成</p>
<p>返回子进程向标准输出的输出结果</p>
<p>检查退出信息，如果returncode不为0，则举出错误subprocess.CalledProcessError，该对象包含有returncode属性和output属性，output属性为标准输出的输出结果，可用try...except...来检查</p>
<p>例如:</p>
<div class="highlight"><pre><span></span>In [32]: out = subprocess.call(&quot;ls -l&quot;, shell=True)
total 42244
-rw-rw-r--.  1 *** ***     366 May 26 09:10 ChangeLog
</pre></div>


<ul>
<li>4.2.1 </li>
</ul>
<p>上面三个函数都是源于Popen()函数的wapper(封装),如果需要更加个性化应用，那么就需要使用popen()函数</p>
<p>Popen对象创建后，主程序不会自动等待子进程完成。我们必须调用对象的wait()方法，父进程才会等待 (也就是阻塞block)</p>
<div class="highlight"><pre><span></span>[wenwt@localhost syntax]$ rm subprocess.pyc 
[wenwt@localhost syntax]$ python process.py 
parent process
[wenwt@localhost syntax]$ PING www.google.com (173.194.219.99) 56(84) bytes of data.
^C
[wenwt@localhost syntax]$ 
--- www.google.com ping statistics ---
5 packets transmitted, 0 received, 100% packet loss, time 3999ms
</pre></div>


<p>加上wait方法:</p>
<div class="highlight"><pre><span></span>[wenwt@localhost syntax]$ python process.py 
PING www.google.com (173.194.219.103) 56(84) bytes of data.

--- www.google.com ping statistics ---
5 packets transmitted, 0 received, 100% packet loss, time 3999ms

parent process
</pre></div>


</li>
</ul>
</li>
</ul>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="http://www.shushilvshe.com/tag/da-shu-ju.html">大数据</a>
      <a href="http://www.shushilvshe.com/tag/python.html">python</a>
    </p>
  </div>



    <div class="addthis_relatedposts_inline">


</article>

    <footer>
<p>&copy;  </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " shushilvshe's Blog ",
  "url" : "http://www.shushilvshe.com",
  "image": "http://www.shushilvshe.com/images/baya.jpg",
  "description": "shushilvshe's Thoughts and Writings"
}
</script>

</body>
</html>