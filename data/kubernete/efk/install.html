<!DOCTYPE html>
<html lang="en">
<head>
        <title>shushilvshe's Blog : kubernetes（1.8.3）系列之搭建EFK（Fluentd＋Elasticsearch＋Kibana）</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="http://www.shushilvshe.com/theme/css/main.css" type="text/css" />
        <link href="http://www.shushilvshe.com/" type="application/atom+xml" rel="alternate" title="shushilvshe's Blog ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://www.shushilvshe.com/css/ie.css"/>
                <script src="http://www.shushilvshe.com/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://www.shushilvshe.com/css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="http://www.shushilvshe.com/data/kubernete/efk/install.html" id="page-title">kubernetes（1.8.3）系列之搭建EFK（Fluentd＋Elasticsearch＋Kibana）</a></h1>
    <span id="sitename"><a href="http://www.shushilvshe.com" id="site-title">shushilvshe's Blog  <strong>Data Developer</strong></a> &sdot;</span>
<time datetime="2018-02-07T15:54:43+08:00">2018-02-07(星期三) 15:54</time></header>
<article>
    <p><link rel="stylesheet" href="http://yandex.st/highlightjs/6.2/styles/googlecode.min.css"></p>
<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>

<script src="http://yandex.st/highlightjs/6.2/highlight.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>

<p><script type="text/javascript">
 $(document).ready(function(){
      $("h2,h3,h4,h5,h6").each(function(i,item){
        var tag = $(item).get(0).localName;
        $(item).attr("id","wow"+i);
        $("#category").append('<a class="new'+tag+'" href="#wow'+i+'">'+$(this).text()+'</a></br>');
        $(".newh2").css("margin-left",0);
        $(".newh3").css("margin-left",30);
        $(".newh4").css("margin-left",60);
        $(".newh5").css("margin-left",90);
        $(".newh6").css("margin-left",120);
      });
 });
</script>
<div id="category"></div></p>
<p>docker会将stdout和stderr输出本机的一个目录下，一般是/var/lib/docker/contianers（也可能是/opt/docker/containers/，根据安装方式不同而不同）， kubernetes 默认会将容器的stdout和stderr录入node(minion)的/var/log/containers目录下（最后还是链接到docker的日志路径下）,而kubernetes 组件的日志默认放置在/var/log目录下。</p>
<p>EFK搭建使用的日志架构：</p>
<p><center><img src="https://i.imgur.com/clLKVgA.jpg" width="600"/></center></p>
<h2>EFK安装</h2>
<h3>EFK介绍</h3>
<ul>
<li>Fluentd 2.0.1：负责收集日志（或者用Logstash，相对比较耗内存）</li>
<li>Elasticsearch 5.5.1：存储日志并提供搜索</li>
<li>Kibana 5.5.1：负责日志查询和展示</li>
</ul>
<blockquote>
<p>官方地址： https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/fluentd-elasticsearch</p>
</blockquote>
<h3>安装EFK插件</h3>
<p>通过在每台node上部署一个以DaemonSet方式运行的fluentd来收集每台node上的日志。Fluentd将docker日志目录/var/lib/docker/containers 和 /var/log 目录挂载到Pod中，然后Pod会在node节点的 /var/log/pods 目录中创建新的目录，可以区别不同的容器日志输出，该目录下有一个日志文件链接到/var/lib/docker/contianers目录下的容器日志输出。</p>
<blockquote>
<p>docker的日志目录可能因为安装方式不同而不同，也可能在 /opt/docker/containers/ 下。</p>
</blockquote>
<p>从官方地址下载所需要的配置文件，默认Fluentd中是监控/var/lib/docker/containers目录的，如果不一样，修改fluentd-es-ds.yaml文件中的挂载路径即可，否则最后不会接收到日志，kibana无法创建初始化的索引模式，这个最后说明。</p>
<div class="highlight"><pre><span></span>-rw-r--r-- 1 root root   382 11月  8 10:26 es-service.yaml
-rw-r--r-- 1 root root  2841 11月  8 10:26 es-statefulset.yaml
-rw-r--r-- 1 root root 13462 11月  8 10:26 fluentd-es-configmap.yaml
-rw-r--r-- 1 root root  2822 2月   5 18:18 fluentd-es-ds.yaml
-rw-r--r-- 1 root root  1111 11月  8 10:26 kibana-deployment.yaml
-rw-r--r-- 1 root root   354 11月  8 10:26 kibana-service.yaml
</pre></div>


<h3>给 Node 设置标签</h3>
<p>定义 DaemonSet fluentd-es-v2.0.1 时设置了 <code>nodeSelector beta.kubernetes.io/fluentd-ds-ready=true</code> ，所以需要在期望运行 fluentd 的 Node 上设置该标签；</p>
<div class="highlight"><pre><span></span>[root@kube_master184 efk]# kubectl get nodes
NAME        STATUS    AGE       VERSION
192.168.1.185   Ready     1d        v1.6.0

[root@kube_master184 efk]# kubectl label nodes 192.168.1.185 beta.kubernetes.io/fluentd-ds-ready=true
node &quot;192.168.1.185&quot; labeled
</pre></div>


<p>给其他几台node打上同样的标签。</p>
<h3>执行定义文件</h3>
<p>在下载好的配置路径下， 此处是 /etc/kubernetes/efk, 执行</p>
<div class="highlight"><pre><span></span>[root@kube_master184 efk]# kubectl create -f .
service &quot;elasticsearch-logging&quot; created
serviceaccount &quot;elasticsearch-logging&quot; created
clusterrole &quot;elasticsearch-logging&quot; created
clusterrolebinding &quot;elasticsearch-logging&quot; created
statefulset &quot;elasticsearch-logging&quot; created
configmap &quot;fluentd-es-config-v0.1.0&quot; created
serviceaccount &quot;fluentd-es&quot; created
clusterrole &quot;fluentd-es&quot; created
clusterrolebinding &quot;fluentd-es&quot; created
daemonset &quot;fluentd-es-v2.0.1&quot; created
deployment &quot;kibana-logging&quot; created
service &quot;kibana-logging&quot; created
</pre></div>


<h3>检查执行结果</h3>
<div class="highlight"><pre><span></span>[root@kube_master184 efk]# kubectl get deployment -n kube-system|grep kibana
kibana-logging             1         1         1            1           1d

[root@kube_master184 efk]# kubectl get pods -n kube-system|grep -E &#39;elasticsearch|fluentd|kibana&#39;
elasticsearch-logging-0                    1/1       Running   4          1d
elasticsearch-logging-1                    1/1       Running   0          1d
fluentd-es-v2.0.1-8d67k                    1/1       Running   0          1d
fluentd-es-v2.0.1-hzjfw                    1/1       Running   0          1d
fluentd-es-v2.0.1-tkbbn                    1/1       Running   0          1d
fluentd-es-v2.0.1-vmhhf                    1/1       Running   0          1d
fluentd-es-v2.0.1-vzkwz                    1/1       Running   0          1d
kibana-logging-5d7cbc6b5d-fbd4r            1/1       Running   0          1d

[root@kube_master184 efk]# kubectl get service  -n kube-system|grep -E &#39;elasticsearch|kibana&#39;  
elasticsearch-logging   ClusterIP   10.254.45.109    &lt;none&gt;        9200/TCP            1d
kibana-logging          ClusterIP   10.254.103.74    &lt;none&gt;        5601/TCP            1d
</pre></div>


<p>kibana Pod 第一次启动时会用较长时间(10-20分钟)来优化和 Cache 状态页面，可以 tailf 该 Pod 的日志观察进度：</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">kube_master184</span> <span class="n">efk</span><span class="p">]</span><span class="err">#</span> <span class="n">kubectl</span> <span class="n">logs</span> <span class="n">kibana</span><span class="o">-</span><span class="n">logging</span><span class="o">-</span><span class="mi">5</span><span class="n">d7cbc6b5d</span><span class="o">-</span><span class="n">fbd4r</span> <span class="o">-</span><span class="n">n</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span> <span class="o">-</span><span class="n">f</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:14:14Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&quot;optimize&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Optimizing and caching bundles for graph, ml, kibana, stateSessionStorageRedirect, timelion and status_page. This may take a few minutes&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&quot;optimize&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Optimization of bundles for graph, ml, kibana, stateSessionStorageRedirect, timelion and status_page complete in 106.41 seconds&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:kibana@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:elasticsearch@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to yellow - Waiting for Elasticsearch&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:xpack_main@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to yellow - Waiting for Elasticsearch&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:graph@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to yellow - Waiting for Elasticsearch&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;reporting&quot;</span><span class="p">,</span><span class="s">&quot;warning&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Generating a random key for xpack.reporting.encryptionKey. To prevent pending reports from failing on restart, please set xpack.reporting.encryptionKey in kibana.yml&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:reporting@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to yellow - Waiting for Elasticsearch&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:07Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:xpack_main@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to yellow - No existing Kibana index found&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Waiting for Elasticsearch&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:07Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:graph@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to yellow - No existing Kibana index found&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Waiting for Elasticsearch&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:07Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:reporting@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to yellow - No existing Kibana index found&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Waiting for Elasticsearch&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:07Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:elasticsearch@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to yellow - No existing Kibana index found&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Waiting for Elasticsearch&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:08Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:elasticsearch@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to green - Kibana index ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;No existing Kibana index found&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:08Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;license&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&quot;xpack&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Imported license information from Elasticsearch for [data] cluster: mode: trial | status: active | expiry date: 2018-03-07T10:15:05+00:00&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:08Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:xpack_main@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;No existing Kibana index found&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:08Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:graph@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;No existing Kibana index found&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:08Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:reporting@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;No existing Kibana index found&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:searchprofiler@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:ml@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:ml@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from green to yellow - Waiting for Elasticsearch&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Ready&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:ml@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Waiting for Elasticsearch&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:tilemap@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:watcher@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:grokdebugger@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:console@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:metrics@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:timelion@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;listening&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Server running at http://0:5601&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;ui settings&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
</pre></div>


<h2>访问 kibana</h2>
<ul>
<li><strong>通过 kube-apiserver 访问：</strong></li>
</ul>
<p>获取 Kibana 服务 URL。</p>
<div class="highlight"><pre><span></span>[root@kube_master184 efk]# kubectl cluster-info
Kubernetes master is running at https://127.0.0.1:6443
Elasticsearch is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy
Heapster is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/heapster/proxy
Kibana is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kibana-logging/proxy
KubeDNS is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kube-dns/proxy
kubernetes-dashboard is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kubernetes-dashboard/proxy
monitoring-grafana is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy

To further debug and diagnose cluster problems, use &#39;kubectl cluster-info dump&#39;.
</pre></div>


<p>浏览器访问 URL： https://192.168.1.184:6443/api/v1/proxy/namespaces/kube-system/services/kibana-logging</p>
<ul>
<li>
<p><strong>通过 kubectl proxy 访问：</strong></p>
<p>创建代理</p>
<div class="highlight"><pre><span></span> $ kubectl proxy --address=&#39;192.168.1.184&#39; --port=9999 --accept-hosts=&#39;^*$&#39;
 Starting to serve on 192.168.1.184:9999
</pre></div>


<p>浏览器访问 URL：http://192.168.1.184:9999/api/v1/proxy/namespaces/kube-system/services/kibana-logging</p>
</li>
</ul>
<p><strong>初始化 kibana</strong></p>
<div class="highlight"><pre><span></span>在 Management -&gt; Index Patterns 页面创建一个 index（相当于 mysql 中的一个 database），`Index name or pattern` 使用默认的 logstash-*，`Time Filter field name` 下拉选中@timestamp, 点击 Create, 过一会儿就可以在 Discover页面查询日志了;

<span class="nt">&lt;center&gt;&lt;img</span> <span class="na">src=</span><span class="s">&quot;https://i.imgur.com/cEzP8rK.jpg&quot;</span> <span class="na">width=</span><span class="s">&quot;1280&quot;</span><span class="nt">/&gt;&lt;/center&gt;</span>

最后， 日志收集部分，除了Fluentd和Logstash，还可以使用Filebeat来收集日志，使用方法可以参考[使用Filebeat收集Kubernetes中的应用日志](https://jimmysong.io/posts/kubernetes-filebeat/)。
</pre></div>


<h2>遇到问题</h2>
<h3>1. unable to fetch mapping. do you have indices matching the pattern kibana.</h3>
<p>如果你在这里发现最下方并没有变成Create按钮且出现如下错误，说明fluent并没有向elasticsearch中写入数据，所以，分别检查fluent、elasticsearch的配置和日志，一定是两者之间通信出现问题了。</p>
<p><center><img src="https://i.imgur.com/q9K9QWj.jpg" width="1280"/></center></p>
<p>本次错误是因为docker写的日志并不在fluentd-es-ds.yaml配置文件中默认配置的/var/lib/docker/containers路径下，而在/opt/docker/containers下，所以并没有找到对应的日志文件（在不经意间查看/var/log/pods/下的文件时，发现链接的是/opt/docker/containers/路径下的文件，解决的办法就简单了，删掉原来的deamon-set, 修改挂载路径重新启动fluent即可了）</p>
<div class="highlight"><pre><span></span>[root@gpu185 ea29c93b-0a45-11e8-af3c-d4bed9a7f66c]# ll
total 0
lrwxrwxrwx 1 root root 161 Feb  5 15:26 fluentd-es_0.log -&gt; /opt/docker/containers/866f239a95f8530de148e5f2a178c55e0bdc4e5a918ed762e134ab94b134981d/866f239a95f8530de148e5f2a178c55e0bdc4e5a918ed762e134ab94b134981d-json.log
</pre></div>


<blockquote>
<p>还有一种可能是因为docker的log-driver的设置，需要是json-file格式的，docker默认就是这种格式，如果以前修改过，需要改成json-file, 具体修改方法参考 <a href="https://docs.docker.com/engine/admin/logging/overview/#examples">docker logging</a></p>
</blockquote>
<h3>2. 修改elasticsearch日志文件存储位置</h3>
<p>下载的es-statefulset.yaml配置文件中，默认是把elasticsearch的日志存储放在了pod的empty volumns里了，因此官方的部署参考仅可用于试验，实际部署到生产环境时需要使用Persistent Volume。如存储到node具体路径或ceph等。</p>
<h2>参考文档</h2>
<p><a href="https://docs.docker.com/config/containers/logging/configure/">Docker Configure logging drivers</a></p>
<p><a href="https://www.fluentd.org/plugins/all#input-output">Fluentd Plugins</a></p>
<p><a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">Kubernetes Logging Architecture</a></p>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/foreword_id.html">Elasticsearch: 权威指南</a></p>
<p><a href="https://jimmysong.io/kubernetes-handbook/practice/efk-addon-installation.html">安装EFK插件</a></p>
<p><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=8159377">Kibana 5.2 中文文档</a></p>
<p><a href="http://docs.saas.hand-china.com/docs/hitoa/zh_CN/latest/user-guide/log-aggregation-analysis/td-agent-config-file-syntax.html">fluentd配置文件语法</a></p>
<p><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/">使用fluentd实现实时收集日志文件</a></p>
</article>

        <footer>
            <nav>
                <ul>
                    <li><a href="http://www.shushilvshe.com/pages/about.html">About ME</a></li>
                    <li>:: <a href="http://www.shushilvshe.com/categories.html">Categories</a></li>
                    <li>:: <a href="http://www.shushilvshe.com/tags.html">Tags</a></li>
                </ul>
            </nav>
                <p id="theme-credit">Proudly powered by <a href="http://docs.notmyidea.org/alexis/pelican/">pelican</a></p>
        </footer>

</body>
</html>