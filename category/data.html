<meta property="og:title" content="shushilvshe's Blog" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://www.shushilvshe.com" />
<meta name="twitter:url" content="http://www.shushilvshe.com" />
<meta itemprop="name" content="shushilvshe's Blog">
<meta itemprop="url" content="http://www.shushilvshe.com">

<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="zh_cn" class="no-js lt-ie9 lt-ie8 lt-ie7" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/Blog"> <![endif]-->
<!--[if IE 7]>         <html lang="zh_cn" class="no-js lt-ie9 lt-ie8" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/Blog"> <![endif]-->
<!--[if IE 8]>         <html lang="zh_cn" class="no-js lt-ie9" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/Blog"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="zh_cn" class="no-js" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/Blog"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Data</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<link rel="shortcut icon" href="http://www.shushilvshe.com/http://www.shushilvshe.com/images/lvcheng.jpg" type="">
<meta name="author" content="ssls">
<meta name="copyright" content="ssls">
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta property="og:site_name" content="shushilvshe's Blog" />
<meta property="og:title" content="shushilvshe's Blog" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://www.shushilvshe.com" />
<meta name="twitter:url" content="http://www.shushilvshe.com" />
<meta itemprop="name" content="shushilvshe's Blog" />
<meta itemprop="url" content="http://www.shushilvshe.com"/>
<link href="http://www.shushilvshe.com/None" type="application/atom+xml" rel="alternate" title="shushilvshe's Blog ATOM Feed"/>
<link href='//fonts.googleapis.com/css?family=Open+Sans:800italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/css/uikit.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/css/components/search.min.css">
<link rel="stylesheet" href="http://www.shushilvshe.com/theme/css/tipuesearch.css">
<link rel="stylesheet" href="http://www.shushilvshe.com/theme/css/solarized.css">
<link rel="stylesheet" href="http://www.shushilvshe.com/theme/css/main.css">

<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
</head>
<body>
<!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

<header class=" mg-header uk-navbar uk-navbar-attached">

    <div class="uk-container uk-container-center">

        <a class="mg-brand uk-navbar-brand uk-hidden-small" href="http://www.shushilvshe.com">shushilvshe's Blog</a>
        <div class="mg-tagline uk-navbar-content uk-hidden-small">Data Developer</div>
        <a class="uk-navbar-toggle uk-visible-small" href="#mg-offcanvas" data-uk-offcanvas></a>
        <a class="mg-brand uk-navbar-brand uk-navbar-center uk-visible-small" href="http://www.shushilvshe.com">shushilvshe's Blog</a>

    </div>
</header>

<main class="mg-main">

<div class="uk-container uk-container-center">

    <div class="uk-grid" data-uk-grid-margin>

<div class="uk-width-medium-4-5">


            <article class="uk-article" itemtype="http://schema.org/BlogPosting" itemscope="itemscope" itemprop="blogPost">
                <a href="http://www.shushilvshe.com/data/kubernete/efk/install.html" class="uk-article-title uk-link-muted" itemprop="name">kubernetes（1.8.3）系列之搭建EFK（Fluentd＋Elasticsearch＋Kibana）</a>
                <p class="uk-article-meta"><time datetime="2018-02-07" itemprop="datePublished">2018-02-07(星期三) 15:54</time> • <a href="http://www.shushilvshe.com/category/data.html">Data</a></p>
</p>
                <p class="uk-article-lead" itemprop="description">docker会将stdout和stderr输出本机的一个目录下，一般是/var/lib/docker/contianers（也可能是/opt/docker/containers/，根据安装方式不同而不同）， kubernetes 默认会将容器的stdout和stderr录入node(minion)的/var/log/containers目录下（最后还是链接到docker的日志路径下）,而kubernetes 组件的日志默认放置在/var/log目录下。</p>
                <section itemprop="articleBody"><p><link rel="stylesheet" href="http://yandex.st/highlightjs/6.2/styles/googlecode.min.css"></p>
<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>

<script src="http://yandex.st/highlightjs/6.2/highlight.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>

<p><script type="text/javascript">
 $(document).ready(function(){
      $("h2,h3,h4,h5,h6").each(function(i,item){
        var tag = $(item).get(0).localName;
        $(item).attr("id","wow"+i);
        $("#category").append('<a class="new'+tag+'" href="#wow'+i+'">'+$(this).text()+'</a></br>');
        $(".newh2").css("margin-left",0);
        $(".newh3").css("margin-left",30);
        $(".newh4").css("margin-left",60);
        $(".newh5").css("margin-left",90);
        $(".newh6").css("margin-left",120);
      });
 });
</script>
<div id="category"></div></p>
<p>docker会将stdout和stderr输出本机的一个目录下，一般是/var/lib/docker/contianers（也可能是/opt/docker/containers/，根据安装方式不同而不同）， kubernetes 默认会将容器的stdout和stderr录入node(minion)的/var/log/containers目录下（最后还是链接到docker的日志路径下）,而kubernetes 组件的日志默认放置在/var/log目录下。</p>
<p>EFK搭建使用的日志架构：</p>
<p><center><img src="https://i.imgur.com/clLKVgA.jpg" width="600"/></center></p>
<h2>EFK安装</h2>
<h3>EFK介绍</h3>
<ul>
<li>Fluentd 2.0.1：负责收集日志（或者用Logstash，相对比较耗内存）</li>
<li>Elasticsearch 5.5.1：存储日志并提供搜索</li>
<li>Kibana 5.5.1：负责日志查询和展示</li>
</ul>
<blockquote>
<p>官方地址： https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/fluentd-elasticsearch</p>
</blockquote>
<h3>安装EFK插件</h3>
<p>通过在每台node上部署一个以DaemonSet方式运行的fluentd来收集每台node上的日志。Fluentd将docker日志目录/var/lib/docker/containers 和 /var/log 目录挂载到Pod中，然后Pod会在node节点的 /var/log/pods 目录中创建新的目录，可以区别不同的容器日志输出，该目录下有一个日志文件链接到/var/lib/docker/contianers目录下的容器日志输出。</p>
<blockquote>
<p>docker的日志目录可能因为安装方式不同而不同，也可能在 /opt/docker/containers/ 下。</p>
</blockquote>
<p>从官方地址下载所需要的配置文件，默认Fluentd中是监控/var/lib/docker/containers目录的，如果不一样，修改fluentd-es-ds.yaml文件中的挂载路径即可，否则最后不会接收到日志，kibana无法创建初始化的索引模式，这个最后说明。</p>
<div class="highlight"><pre><span></span>-rw-r--r-- 1 root root   382 11月  8 10:26 es-service.yaml
-rw-r--r-- 1 root root  2841 11月  8 10:26 es-statefulset.yaml
-rw-r--r-- 1 root root 13462 11月  8 10:26 fluentd-es-configmap.yaml
-rw-r--r-- 1 root root  2822 2月   5 18:18 fluentd-es-ds.yaml
-rw-r--r-- 1 root root  1111 11月  8 10:26 kibana-deployment.yaml
-rw-r--r-- 1 root root   354 11月  8 10:26 kibana-service.yaml
</pre></div>


<h3>给 Node 设置标签</h3>
<p>定义 DaemonSet fluentd-es-v2.0.1 时设置了 <code>nodeSelector beta.kubernetes.io/fluentd-ds-ready=true</code> ，所以需要在期望运行 fluentd 的 Node 上设置该标签；</p>
<div class="highlight"><pre><span></span>[root@kube_master184 efk]# kubectl get nodes
NAME        STATUS    AGE       VERSION
192.168.1.185   Ready     1d        v1.6.0

[root@kube_master184 efk]# kubectl label nodes 192.168.1.185 beta.kubernetes.io/fluentd-ds-ready=true
node &quot;192.168.1.185&quot; labeled
</pre></div>


<p>给其他几台node打上同样的标签。</p>
<h3>执行定义文件</h3>
<p>在下载好的配置路径下， 此处是 /etc/kubernetes/efk, 执行</p>
<div class="highlight"><pre><span></span>[root@kube_master184 efk]# kubectl create -f .
service &quot;elasticsearch-logging&quot; created
serviceaccount &quot;elasticsearch-logging&quot; created
clusterrole &quot;elasticsearch-logging&quot; created
clusterrolebinding &quot;elasticsearch-logging&quot; created
statefulset &quot;elasticsearch-logging&quot; created
configmap &quot;fluentd-es-config-v0.1.0&quot; created
serviceaccount &quot;fluentd-es&quot; created
clusterrole &quot;fluentd-es&quot; created
clusterrolebinding &quot;fluentd-es&quot; created
daemonset &quot;fluentd-es-v2.0.1&quot; created
deployment &quot;kibana-logging&quot; created
service &quot;kibana-logging&quot; created
</pre></div>


<h3>检查执行结果</h3>
<div class="highlight"><pre><span></span>[root@kube_master184 efk]# kubectl get deployment -n kube-system|grep kibana
kibana-logging             1         1         1            1           1d

[root@kube_master184 efk]# kubectl get pods -n kube-system|grep -E &#39;elasticsearch|fluentd|kibana&#39;
elasticsearch-logging-0                    1/1       Running   4          1d
elasticsearch-logging-1                    1/1       Running   0          1d
fluentd-es-v2.0.1-8d67k                    1/1       Running   0          1d
fluentd-es-v2.0.1-hzjfw                    1/1       Running   0          1d
fluentd-es-v2.0.1-tkbbn                    1/1       Running   0          1d
fluentd-es-v2.0.1-vmhhf                    1/1       Running   0          1d
fluentd-es-v2.0.1-vzkwz                    1/1       Running   0          1d
kibana-logging-5d7cbc6b5d-fbd4r            1/1       Running   0          1d

[root@kube_master184 efk]# kubectl get service  -n kube-system|grep -E &#39;elasticsearch|kibana&#39;  
elasticsearch-logging   ClusterIP   10.254.45.109    &lt;none&gt;        9200/TCP            1d
kibana-logging          ClusterIP   10.254.103.74    &lt;none&gt;        5601/TCP            1d
</pre></div>


<p>kibana Pod 第一次启动时会用较长时间(10-20分钟)来优化和 Cache 状态页面，可以 tailf 该 Pod 的日志观察进度：</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">kube_master184</span> <span class="n">efk</span><span class="p">]</span><span class="err">#</span> <span class="n">kubectl</span> <span class="n">logs</span> <span class="n">kibana</span><span class="o">-</span><span class="n">logging</span><span class="o">-</span><span class="mi">5</span><span class="n">d7cbc6b5d</span><span class="o">-</span><span class="n">fbd4r</span> <span class="o">-</span><span class="n">n</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span> <span class="o">-</span><span class="n">f</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:14:14Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&quot;optimize&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Optimizing and caching bundles for graph, ml, kibana, stateSessionStorageRedirect, timelion and status_page. This may take a few minutes&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&quot;optimize&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Optimization of bundles for graph, ml, kibana, stateSessionStorageRedirect, timelion and status_page complete in 106.41 seconds&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:kibana@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:elasticsearch@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to yellow - Waiting for Elasticsearch&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:xpack_main@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to yellow - Waiting for Elasticsearch&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:graph@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to yellow - Waiting for Elasticsearch&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;reporting&quot;</span><span class="p">,</span><span class="s">&quot;warning&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Generating a random key for xpack.reporting.encryptionKey. To prevent pending reports from failing on restart, please set xpack.reporting.encryptionKey in kibana.yml&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:01Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:reporting@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to yellow - Waiting for Elasticsearch&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:07Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:xpack_main@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to yellow - No existing Kibana index found&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Waiting for Elasticsearch&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:07Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:graph@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to yellow - No existing Kibana index found&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Waiting for Elasticsearch&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:07Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:reporting@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to yellow - No existing Kibana index found&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Waiting for Elasticsearch&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:07Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:elasticsearch@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to yellow - No existing Kibana index found&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Waiting for Elasticsearch&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:08Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:elasticsearch@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to green - Kibana index ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;No existing Kibana index found&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:08Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;license&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&quot;xpack&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Imported license information from Elasticsearch for [data] cluster: mode: trial | status: active | expiry date: 2018-03-07T10:15:05+00:00&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:08Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:xpack_main@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;No existing Kibana index found&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:08Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:graph@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;No existing Kibana index found&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:08Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:reporting@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;No existing Kibana index found&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:searchprofiler@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:ml@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:ml@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from green to yellow - Waiting for Elasticsearch&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Ready&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:ml@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from yellow to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;yellow&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;Waiting for Elasticsearch&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:tilemap@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:watcher@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:grokdebugger@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:console@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:metrics@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;plugin:timelion@5.5.1&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;listening&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Server running at http://0:5601&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;log&quot;</span><span class="p">,</span><span class="s">&quot;@timestamp&quot;</span><span class="o">:</span><span class="s">&quot;2018-02-05T10:16:12Z&quot;</span><span class="p">,</span><span class="s">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="s">&quot;ui settings&quot;</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">],</span><span class="s">&quot;pid&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="o">:</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="s">&quot;message&quot;</span><span class="o">:</span><span class="s">&quot;Status changed from uninitialized to green - Ready&quot;</span><span class="p">,</span><span class="s">&quot;prevState&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">,</span><span class="s">&quot;prevMsg&quot;</span><span class="o">:</span><span class="s">&quot;uninitialized&quot;</span><span class="p">}</span>
</pre></div>


<h2>访问 kibana</h2>
<ul>
<li><strong>通过 kube-apiserver 访问：</strong></li>
</ul>
<p>获取 Kibana 服务 URL。</p>
<div class="highlight"><pre><span></span>[root@kube_master184 efk]# kubectl cluster-info
Kubernetes master is running at https://127.0.0.1:6443
Elasticsearch is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy
Heapster is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/heapster/proxy
Kibana is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kibana-logging/proxy
KubeDNS is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kube-dns/proxy
kubernetes-dashboard is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kubernetes-dashboard/proxy
monitoring-grafana is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy

To further debug and diagnose cluster problems, use &#39;kubectl cluster-info dump&#39;.
</pre></div>


<p>浏览器访问 URL： https://192.168.1.184:6443/api/v1/proxy/namespaces/kube-system/services/kibana-logging</p>
<ul>
<li>
<p><strong>通过 kubectl proxy 访问：</strong></p>
<p>创建代理</p>
<div class="highlight"><pre><span></span> $ kubectl proxy --address=&#39;192.168.1.184&#39; --port=9999 --accept-hosts=&#39;^*$&#39;
 Starting to serve on 192.168.1.184:9999
</pre></div>


<p>浏览器访问 URL：http://192.168.1.184:9999/api/v1/proxy/namespaces/kube-system/services/kibana-logging</p>
</li>
</ul>
<p><strong>初始化 kibana</strong></p>
<div class="highlight"><pre><span></span>在 Management -&gt; Index Patterns 页面创建一个 index（相当于 mysql 中的一个 database），`Index name or pattern` 使用默认的 logstash-*，`Time Filter field name` 下拉选中@timestamp, 点击 Create, 过一会儿就可以在 Discover页面查询日志了;

<span class="nt">&lt;center&gt;&lt;img</span> <span class="na">src=</span><span class="s">&quot;https://i.imgur.com/cEzP8rK.jpg&quot;</span> <span class="na">width=</span><span class="s">&quot;1280&quot;</span><span class="nt">/&gt;&lt;/center&gt;</span>

最后， 日志收集部分，除了Fluentd和Logstash，还可以使用Filebeat来收集日志，使用方法可以参考[使用Filebeat收集Kubernetes中的应用日志](https://jimmysong.io/posts/kubernetes-filebeat/)。
</pre></div>


<h2>遇到问题</h2>
<h3>1. unable to fetch mapping. do you have indices matching the pattern kibana.</h3>
<p>如果你在这里发现最下方并没有变成Create按钮且出现如下错误，说明fluent并没有向elasticsearch中写入数据，所以，分别检查fluent、elasticsearch的配置和日志，一定是两者之间通信出现问题了。</p>
<p><center><img src="https://i.imgur.com/q9K9QWj.jpg" width="1280"/></center></p>
<p>本次错误是因为docker写的日志并不在fluentd-es-ds.yaml配置文件中默认配置的/var/lib/docker/containers路径下，而在/opt/docker/containers下，所以并没有找到对应的日志文件（在不经意间查看/var/log/pods/下的文件时，发现链接的是/opt/docker/containers/路径下的文件，解决的办法就简单了，删掉原来的deamon-set, 修改挂载路径重新启动fluent即可了）</p>
<div class="highlight"><pre><span></span>[root@gpu185 ea29c93b-0a45-11e8-af3c-d4bed9a7f66c]# ll
total 0
lrwxrwxrwx 1 root root 161 Feb  5 15:26 fluentd-es_0.log -&gt; /opt/docker/containers/866f239a95f8530de148e5f2a178c55e0bdc4e5a918ed762e134ab94b134981d/866f239a95f8530de148e5f2a178c55e0bdc4e5a918ed762e134ab94b134981d-json.log
</pre></div>


<blockquote>
<p>还有一种可能是因为docker的log-driver的设置，需要是json-file格式的，docker默认就是这种格式，如果以前修改过，需要改成json-file, 具体修改方法参考 <a href="https://docs.docker.com/engine/admin/logging/overview/#examples">docker logging</a></p>
</blockquote>
<h3>2. 修改elasticsearch日志文件存储位置</h3>
<p>下载的es-statefulset.yaml配置文件中，默认是把elasticsearch的日志存储放在了pod的empty volumns里了，因此官方的部署参考仅可用于试验，实际部署到生产环境时需要使用Persistent Volume。如存储到node具体路径或ceph等。</p>
<h2>参考文档</h2>
<p><a href="https://docs.docker.com/config/containers/logging/configure/">Docker Configure logging drivers</a></p>
<p><a href="https://www.fluentd.org/plugins/all#input-output">Fluentd Plugins</a></p>
<p><a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">Kubernetes Logging Architecture</a></p>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/foreword_id.html">Elasticsearch: 权威指南</a></p>
<p><a href="https://jimmysong.io/kubernetes-handbook/practice/efk-addon-installation.html">安装EFK插件</a></p>
<p><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=8159377">Kibana 5.2 中文文档</a></p>
<p><a href="http://docs.saas.hand-china.com/docs/hitoa/zh_CN/latest/user-guide/log-aggregation-analysis/td-agent-config-file-syntax.html">fluentd配置文件语法</a></p>
<p><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/">使用fluentd实现实时收集日志文件</a></p></section>
                <a href="http://www.shushilvshe.com/data/kubernete/efk/install.html#disqus_thread"></a>
                <hr class="uk-article-divider">
            </article>


        <article class="uk-article" itemtype="http://schema.org/BlogPosting" itemscope="itemscope" itemprop="blogPost">
                <a href="http://www.shushilvshe.com/data/kubernete-installation.html" class="uk-article-title uk-link-muted" itemprop="name">kubernetes（1.8.3）系列之安装</a>
                <p class="uk-article-meta"><time datetime="2018-01-23" itemprop="datePublished">2018-01-23(星期二) 20:06</time> • <a href="http://www.shushilvshe.com/category/data.html">Data</a></p>
</p>
                <p class="uk-article-lead" itemprop="description">此次部署kubernetes1.8.3版本使用两台机器进行操作，一台做为Master节点，一台作为Node节点。部署流程及配置与正式环境下是一致的。</p>
                <p>hljs.initHighlightingOnLoad(); $(document).ready(function(){ $("h2,h3,h4,h5,h6").each(function(i,item){ var tag = $(item).get(0).localName; $(item).attr("id","wow"+i); $("#category").append(''+$(this).text()+''); $(".newh2").css("margin-left",0); $(".newh3").css("margin-left",30); $(".newh4").css("margin-left",60); $(".newh5").css("margin-left",90);...</p>
                <a href="http://www.shushilvshe.com/data/kubernete-installation.html">Read More</a>
                <hr class="uk-article-divider">
        </article>


        <article class="uk-article" itemtype="http://schema.org/BlogPosting" itemscope="itemscope" itemprop="blogPost">
                <a href="http://www.shushilvshe.com/data/docker-ssh.html" class="uk-article-title uk-link-muted" itemprop="name">制作ssh互信的docker镜像</a>
                <p class="uk-article-meta"><time datetime="2018-01-04" itemprop="datePublished">2018-01-04(星期四) 18:09</time> • <a href="http://www.shushilvshe.com/category/data.html">Data</a></p>
</p>
                <p class="uk-article-lead" itemprop="description">基于nvidia/cuda的镜像（nvidia/cuda:8.0-cudnn6-runtime-centos7）生成了一个的tensorflow-gpu 1.4.1编译版本的镜像，通过kubernetes（1.8.3）容器编排工具进行容器间的管理。现有六个节点，一台部署kubernetes，无GPU，还有一个节点有4块GPU，余下四个节点均有一块GPU，所有的GPU均为NVIDIA Gefore 1080Ti。为提高工作工程中试错效率，需要将GPU集群资源合理的利用起来，也即需要自动调度和并发使用GPU。经研究，opmpi + nccl（nvidia的）可以实现，但mpi需要集群间的各容器是互信的，但实际运行的环境中所有容器均来源于同一镜像，所以目的就是达到能免密登陆自己就可以了（其实免密登陆本机和登陆别的机器操作基本一样）。</p>
                <p>基于nvidia/cuda的镜像（nvidia/cuda:8.0-cudnn6-runtime-centos7）生成了一个的tensorflow-gpu 1.4.1编译版本的镜像，通过kubernetes（1.8.3）容器编排工具进行容器间的管理。现有六个节点，一台部署kubernetes，无GPU，还有一个节点有4块GPU，余下四个节点均有一块GPU，所有的GPU均为NVIDIA Gefore 1080Ti。为提高工作工程中试错效率，需要将GPU集群资源合理的利用起来，也即需要自动调度和并发使用GPU。经研究，opmpi + nccl（nvidia的）可以实现，但mpi需要集群间的各容器是互信的，但实际运行的环境中所有容器均来源于同一镜像，所以目的就是达到能免密登陆自己就可以了（其实免密登陆本机和登陆别的机器操作基本一样） 首先，要用docker启用一个container sudo docker run -it nvidia/cuda:8.0-cudnn6-runtime-centos7 既然要使用ssh，那么我们肯定要安装ssh。 sudo yum -y install openssh-server openssh-clients 然后，生成公私钥 sshkey-gen -t rsa 然后回车，回车，回车，复制一份公钥生成 authorized_keys（PS： authorized_keys文件权限和id_dsa.pub一致即可）。 cp /root/.ssh/id_dsa.pub /root/.ssh/authorized_keys 修改配置 /etc/ssh/ssh_config， 去除第一次ssh远程登录时fingerprint指纹添加过程（第一次远程ssh主机时提示输入yes/no的过程）： Host * StrictHostKeyChecking no UserKnownHostsFile=/dev/null 然后，使用 docker ps 查看containerId，然后用 container commit CONTAINER 命令生成一个新镜像。 sudo docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]...</p>
                <a href="http://www.shushilvshe.com/data/docker-ssh.html">Read More</a>
                <hr class="uk-article-divider">
        </article>


        <article class="uk-article" itemtype="http://schema.org/BlogPosting" itemscope="itemscope" itemprop="blogPost">
                <a href="http://www.shushilvshe.com/data/kubernete-calico.html" class="uk-article-title uk-link-muted" itemprop="name">kubernetes（1.8.3）系列之calico集成</a>
                <p class="uk-article-meta"><time datetime="2018-01-04" itemprop="datePublished">2018-01-04(星期四) 14:50</time> • <a href="http://www.shushilvshe.com/category/data.html">Data</a></p>
</p>
                <p class="uk-article-lead" itemprop="description">目前工作试错环境为 k8s（1.8.3）管理下的 tensorflow-1.4.1-compile-py36 docker镜像深度学习集群，说是集群，但平时的工作任务依然是依靠单台跑脚本运行的，GPU的利用率比较低，经过研究，最后决定通过 openmpi-2.1.2 + nccl2 + nccl_2.1.2-1+cuda8.0_x86_64 的技术方案实现GPU的并行计算。但将环境部署到K8S集群时碰到一个问题——在同一个节点中启动的pod可以成功执行，但不同节点间的pods无法成功执行，报错如下：</p>
                <p>hljs.initHighlightingOnLoad(); $(document).ready(function(){ $("h2,h3,h4,h5,h6").each(function(i,item){ var tag = $(item).get(0).localName; $(item).attr("id","wow"+i); $("#category").append(''+$(this).text()+''); $(".newh2").css("margin-left",0); $(".newh3").css("margin-left",20); $(".newh4").css("margin-left",40); $(".newh5").css("margin-left",60);...</p>
                <a href="http://www.shushilvshe.com/data/kubernete-calico.html">Read More</a>
                <hr class="uk-article-divider">
        </article>


        <article class="uk-article" itemtype="http://schema.org/BlogPosting" itemscope="itemscope" itemprop="blogPost">
                <a href="http://www.shushilvshe.com/data/kubernetes-overview.html" class="uk-article-title uk-link-muted" itemprop="name">Kubernetes（1.8.3）系列之GPU配置</a>
                <p class="uk-article-meta"><time datetime="2017-12-20" itemprop="datePublished">2017-12-20(星期三) 10:15</time> • <a href="http://www.shushilvshe.com/category/data.html">Data</a></p>
</p>
                <p class="uk-article-lead" itemprop="description"></p>
                <p>hljs.initHighlightingOnLoad(); $(document).ready(function(){ $("h2,h3,h4,h5,h6").each(function(i,item){ var tag = $(item).get(0).localName; $(item).attr("id","wow"+i); $("#category").append(''+$(this).text()+''); $(".newh2").css("margin-left",0); $(".newh3").css("margin-left",20); $(".newh4").css("margin-left",40); $(".newh5").css("margin-left",60);...</p>
                <a href="http://www.shushilvshe.com/data/kubernetes-overview.html">Read More</a>
                <hr class="uk-article-divider">
        </article>


        <article class="uk-article" itemtype="http://schema.org/BlogPosting" itemscope="itemscope" itemprop="blogPost">
                <a href="http://www.shushilvshe.com/data/tensorflow-docker-deploy.html" class="uk-article-title uk-link-muted" itemprop="name">tensorflow-gpu-docker镜像安装及部署文档</a>
                <p class="uk-article-meta"><time datetime="2017-12-15" itemprop="datePublished">2017-12-15(星期五) 18:01</time> • <a href="http://www.shushilvshe.com/category/data.html">Data</a></p>
</p>
                <p class="uk-article-lead" itemprop="description">制作包含有nvidia cuda、cudnn环境的tensorflow-gpu镜像包，并通过portainer手动单点配置及kubernetes集群管理两种方式进行部署。</p>
                <p>hljs.initHighlightingOnLoad(); $(document).ready(function(){ $("h2,h3,h4,h5,h6").each(function(i,item){ var tag = $(item).get(0).localName; $(item).attr("id","wow"+i); $("#category").append(''+$(this).text()+''); $(".newh2").css("margin-left",0); $(".newh3").css("margin-left",20); $(".newh4").css("margin-left",40); $(".newh5").css("margin-left",60);...</p>
                <a href="http://www.shushilvshe.com/data/tensorflow-docker-deploy.html">Read More</a>
                <hr class="uk-article-divider">
        </article>


        <article class="uk-article" itemtype="http://schema.org/BlogPosting" itemscope="itemscope" itemprop="blogPost">
                <a href="http://www.shushilvshe.com/data/docker.html" class="uk-article-title uk-link-muted" itemprop="name">始入Docker</a>
                <p class="uk-article-meta"><time datetime="2017-12-09" itemprop="datePublished">2017-12-09(星期六) 21:18</time> • <a href="http://www.shushilvshe.com/category/data.html">data</a></p>
</p>
                <p class="uk-article-lead" itemprop="description">容器技术已经发展的很成熟了，只不过因为工作需要才接触。纵观大趋势，系统应用部署能节约大量的人力物力和时间等企业重要成本，所以，掌握好容器技术，以及相关的集群集成管理工具的领头羊——Kubernetes，将成为丰富人生技术栈中重要的一环。</p>
                <p>hljs.initHighlightingOnLoad(); $(document).ready(function(){ $("h2,h3,h4,h5,h6").each(function(i,item){ var tag = $(item).get(0).localName; $(item).attr("id","wow"+i); $("#category").append(''+$(this).text()+''); $(".newh2").css("margin-left",0); $(".newh3").css("margin-left",20); $(".newh4").css("margin-left",40); $(".newh5").css("margin-left",60);...</p>
                <a href="http://www.shushilvshe.com/data/docker.html">Read More</a>
                <hr class="uk-article-divider">
        </article>


        <article class="uk-article" itemtype="http://schema.org/BlogPosting" itemscope="itemscope" itemprop="blogPost">
                <a href="http://www.shushilvshe.com/data/matplotlib_wrong_setup.html" class="uk-article-title uk-link-muted" itemprop="name">python2.7安装matplotlib失败解决方法</a>
                <p class="uk-article-meta"><time datetime="2017-11-10" itemprop="datePublished">2017-11-10(星期五) 15:27</time> • <a href="http://www.shushilvshe.com/category/data.html">Data</a></p>
</p>
                <p class="uk-article-lead" itemprop="description">python2.7安装matplotlib失败解决方法</p>
                <p>本人使用python2.7版本，在跑VGG19网络的时候，需要用到matplotlib模块，但是使用 pip install matplotlib 指令报如下错误： Failed building wheel for subprocess32 以及 error: command 'gcc' failed with exit status 1 尝试先安装 # pip install subprocess32 然后在本地文件夹下边出现一个subprocess32-3.2.7.tar.gz（也可以通过 pip download subprocess32 下载），通过 # tar -zxvf subprocess32-3.2.7.tar.gz 解压之后，出现subprocess32-3.2.7文件夹，进入文件夹看到有个setup.py文件，用 # python setup.py install 发现安装失败，与直接安装matplotlib包出现同样的问题。 谷歌了一下错误 [error: command 'gcc' failed with exit status 1], 通过以下指令解决了问题： # sudo yum -y install gcc gcc-c++ kernel-devel # sudo yum -y install python-devel libxslt-devel libffi-devel openssl-devel # python setup.py install # pip install matplotlib 成功安装了matplotlib包。 （可能问题有异同，仅供参考）...</p>
                <a href="http://www.shushilvshe.com/data/matplotlib_wrong_setup.html">Read More</a>
                <hr class="uk-article-divider">
        </article>


        <article class="uk-article" itemtype="http://schema.org/BlogPosting" itemscope="itemscope" itemprop="blogPost">
                <a href="http://www.shushilvshe.com/data/VOD.html" class="uk-article-title uk-link-muted" itemprop="name">搭建视频点播(VOD)服务（live555 + ffmpeg）</a>
                <p class="uk-article-meta"><time datetime="2017-11-01" itemprop="datePublished">2017-11-01(星期三) 19:12</time> • <a href="http://www.shushilvshe.com/category/data.html">Data</a></p>
</p>
                <p class="uk-article-lead" itemprop="description">前两三个月在整人脸考勤的项目，大体上分实时视频和点播两大块，实时视频使用的是ffserver流媒体服务器，负责从海康威视摄像头接收实时视频流，转而可实时查看原始视频流，同时进行人脸检测识别，最后可将原始视频流或经ai处理的视频流通过ffmpeg录制。将ffmpeg录制的视频后缀修改为live555规定的格式后即可通过rtsp流就行点播。</p>
                <p>目录： hljs.initHighlightingOnLoad(); $(document).ready(function(){ $("h2,h3,h4,h5,h6").each(function(i,item){ var tag = $(item).get(0).localName; $(item).attr("id","wow"+i); $("#category").append(''+$(this).text()+''); $(".newh2").css("margin-left",0); $(".newh3").css("margin-left",20); $(".newh4").css("margin-left",40); $(".newh5").css("margin-left",60);...</p>
                <a href="http://www.shushilvshe.com/data/VOD.html">Read More</a>
                <hr class="uk-article-divider">
        </article>


        <article class="uk-article" itemtype="http://schema.org/BlogPosting" itemscope="itemscope" itemprop="blogPost">
                <a href="http://www.shushilvshe.com/data/font-build.html" class="uk-article-title uk-link-muted" itemprop="name">字体生成小记</a>
                <p class="uk-article-meta"><time datetime="2017-09-29" itemprop="datePublished">2017-09-29(星期五) 14:22</time> • <a href="http://www.shushilvshe.com/category/data.html">Data</a></p>
</p>
                <p class="uk-article-lead" itemprop="description">这个星期我们小组一直在研究根据一部分手写字体，来生成和其风格相符的其他字体，主要工作还是网络的搭建和训练，这不是本文的重点，我们接下来要说的是预测完新字后，如何将这些字的图片，生成字体文件，以供安装使用。</p>
                <p>目录： hljs.initHighlightingOnLoad(); $(document).ready(function(){ $("h2,h3,h4,h5,h6").each(function(i,item){ var tag = $(item).get(0).localName; $(item).attr("id","wow"+i); $("#category").append(''+$(this).text()+''); $(".newh2").css("margin-left",0); $(".newh3").css("margin-left",20); $(".newh4").css("margin-left",40); $(".newh5").css("margin-left",60);...</p>
                <a href="http://www.shushilvshe.com/data/font-build.html">Read More</a>
                <hr class="uk-article-divider">
        </article>

    <ul class="uk-pagination">
        <li class="uk-active"><span>1</span></li>
<li><a href="http://www.shushilvshe.com/category/data2.html"><i class="uk-icon-angle-double-right"></i></a></li><li><a href="http://www.shushilvshe.com/category/data2.html">2</a></li>    </ul>

</div>

        <div class="uk-width-medium-1-5 uk-hidden-small">

            <div class="uk-panel uk-panel-box">
                <form class="uk-search" action="search.html" data-uk-search>
                    <input class="uk-search-field tipue_search" type="search" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
                </form>
            </div>

            <div class="uk-panel uk-panel-box">
                <ul class="uk-nav uk-nav-side">
                    <li class="uk-nav-header">Categories</li>
                    <li class="uk-active"><a href="http://www.shushilvshe.com/category/data.html">Data</a></li>
                    <li ><a href="http://www.shushilvshe.com/category/food.html">food</a></li>
                    <li ><a href="http://www.shushilvshe.com/category/travel.html">travel</a></li>
                    <li class="uk-nav-header">Pages</li>

                    <li >
                        <a href="http://www.shushilvshe.com/pages/about.html">About ME</a>
                    </li>


                    <li class="uk-nav-divider"></li>
                    <li ><a href="http://www.shushilvshe.com/archives.html">Archives</a></li>
                </ul>
            </div>

            <div class="uk-panel uk-panel-box">
                <h3 class="uk-panel-title">Receive Updates</h3>
                <a rel="alternate" type="application/atom+xml" href="http://www.shushilvshe.com/None" class="mg-feed"><i class="uk-icon-rss uk-icon-medium"></i> ATOM</a>
            </div>


        </div>

    </div>

</div>

</main>

<footer class="mg-footer">
    <div class="uk-container uk-container-center uk-text-center">

        <div class="mg-icons-small uk-subnav uk-visible-small">
            <li><a rel="alternate" type="application/atom+xml" href="http://www.shushilvshe.com/None" class="uk-icon-button uk-icon-rss"></a></li>
        </div>

        <div class="mg-author uk-panel">
            <p></p>

            <p>Powered by <a href="http://blog.getpelican.com">Pelican</a>.<br class="uk-visible-small"> Theme <a href="https://github.com/lucachr/pelican-mg">mg</a> by <a href="https://github.com/lucachr">Luca Chiricozzi</a>.</p>
        </div>
    </div>
</footer>

<div id="mg-offcanvas" class="uk-offcanvas">
    <div class="uk-offcanvas-bar">

        <form class="uk-search" action="search.html" data-uk-search>
            <input class="uk-search-field" type="search" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
        </form>

        <ul class="uk-nav uk-nav-offcanvas" data-uk-nav>
            <li class="uk-nav-header">Categories</li>
            <li class="uk-active"><a href="http://www.shushilvshe.com/category/data.html">Data</a></li>
            <li ><a href="http://www.shushilvshe.com/category/food.html">food</a></li>
            <li ><a href="http://www.shushilvshe.com/category/travel.html">travel</a></li>
            <li class="uk-nav-header">Pages</li>
            <li >
                <a href="http://www.shushilvshe.com/pages/about.html">About ME</a>
            </li>


            <li class="uk-nav-divider"></li>
            <li><a href="http://www.shushilvshe.com/">Archives</a></li>
        </ul>
    </div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/js/uikit.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/js/components/search.min.js"></script>
<script src="http://www.shushilvshe.com/theme/js/tipuesearch_set.js"></script>
<script src="http://www.shushilvshe.com/theme/js/tipuesearch.js"></script>
<script src="http://www.shushilvshe.com/theme/js/jquery.sticky-kit.js"></script>
<script src="http://www.shushilvshe.com/theme/js/plugins.js"></script>
<script src="http://www.shushilvshe.com/theme/js/main-search.js"></script>



</body>
</html>
